<header dir="rtl" class="text-center mb-10 px-6 py-12 rounded-3xl
         bg-gradient-to-br from-green-500 to-green-700
         text-white shadow-2xl animate-fadeInDown">
    <h1 class="text-3xl md:text-4xl font-extrabold mb-3">
        ุชูููุฏ ุฎุทุฉ ุบุฐุงุฆูุฉ ุงุญุชุฑุงููุฉ
    </h1>
    <p class="text-base md:text-lg opacity-95 max-w-xl mx-auto leading-relaxed">
        ุงููุฃ ุงูุชูุงุตูู ุฃุฏูุงูุ ุซู ุงุฎุชุฑ ูุฌุจุงุชู.
    </p>
</header>

<form #PlanForm="ngForm" (ngSubmit)="generatePlan()" class="form">

    <!-- ุงุณู ุงูุฎุทุฉ -->
    <div class="form-group full-width">
        <label class="form-label">ุงุณู ุงูุฎุทุฉ</label>
        <input type="text" name="planName" class="form-control" required
            placeholder="ูุซุงู: ุฎุทุฉ ููุฏุงู ุงููุฒู - ุงูุฃุณุจูุน ุงูุฃูู" [(ngModel)]="planName" />
    </div>

    <!-- ุงูุชุงุฑูุฎ -->
    <div class="form-group full-width">
        <label class="form-label">ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</label>
        <input type="date" name="date" class="form-control" required placeholder="ุงุฎุชุฑ ุชุงุฑูุฎ ุงูุจุฏุงูุฉ" [(ngModel)]="date"
            [min]="today" />
    </div>


    <!-- ุงููุฏู ูุงููุธุงู ุงูุบุฐุงุฆู -->
    <div class="form-row">
        <div class="form-group">
            <label class="form-label">ุงููุฏู</label>
            <select name="goal" class="form-control" required [(ngModel)]="goal">
                <option value="" disabled selected hidden>ุงุฎุชุฑ ุงููุฏู</option>
                <option *ngFor="let item of allGoalPlans | async" [value]="item.name">
                    {{ item.name }}
                </option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-label">ููุน ุงููุธุงู ุงูุบุฐุงุฆู</label>
            <select name="systemType" class="form-control" required [(ngModel)]="systemType">
                <option value="" disabled selected hidden>ุงุฎุชุฑ ููุน ุงููุธุงู</option>
                <option *ngFor="let item of allSystemTypePlans | async" [value]="item.name">
                    {{ item.name }}
                </option>
            </select>
        </div>
    </div>

    <!-- ุนุฏุฏ ุงูุฃูุงู ูุนุฏุฏ ุงููุฌุจุงุช -->
    <div class="form-row">
        <div class="form-group">
            <label class="form-label">ุนุฏุฏ ุฃูุงู ุงูุฎุทุฉ</label>
            <select name="numberOfDay" class="form-control" required [(ngModel)]="numberOfDay">
                <option [ngValue]="null" disabled selected hidden>ุงุฎุชุฑ ุนุฏุฏ ุงูุฃูุงู</option>
                <option *ngFor="let num of numberOfDaye" [ngValue]="num">{{ num }} ููู</option>
            </select>
        </div>


        <div class="form-group">
            <label class="form-label">ุนุฏุฏ ุงููุฌุจุงุช ุงูููููุฉ</label>
            <select name="numberOfMeal" class="form-control" required [(ngModel)]="numberOfMeal">
                <option value="" disabled selected hidden>ุงุฎุชุฑ ุนุฏุฏ ุงููุฌุจุงุช</option>
                <option *ngFor="let m of numberOfMeals" [value]="m">{{ m }}</option>
            </select>
        </div>
    </div>

    <!-- ุฃููุงุช ุงููุฌุจุงุช -->
    <div class="form-group full-width">
        <label class="form-label">ุฃููุงุช ุงููุฌุจุงุช</label>
        <input type="text" name="mealTimes" class="form-control" required placeholder="ูุซุงู: ูุทุงุฑ 7ุต - ุบุฏุง 2ุธ - ุนุดุงุก 7ู"
            [(ngModel)]="mealTimes" />
    </div>

    <button type="submit" class="btn-submit" [disabled]="PlanForm.invalid || loading">
        <ng-container *ngIf="loading; else generateText">
            ุฌุงุฑู ุงูุชูููุฏ. <i class="fas fa-spinner fa-spin"></i>
        </ng-container>
        <ng-template #generateText>
            ุชูููุฏ ุงูุฎุทุฉ
        </ng-template>
    </button>


</form>
<!-- ---------------- GENERATED PLAN ------------------- -->

<div *ngFor="let day of mealDaysView" class="day-box">

    <h2 class="day-title">ุงูููู {{ day.dayNumber }}</h2>

    <!-- ูุทุงุฑ -->
    <h3 class="meal-header">๐ณ ูุทุงุฑ</h3>
    <div class="meal-row">
        <div class="meal-item" *ngFor="let m of day.breakfast; let i = index"
            [class.active]="isSelected(day.dayNumber,'breakfast', m)"
            (click)="selectMeal(day.dayNumber,'breakfast', m)">
            <div class="image-wrapper">
                <img [src]="m.image" alt="{{ m.name }}" />
                <span class="meal-type">{{ m.mealType }}</span>
            </div>
            <div class="meal-body">
                <h3 class="meal-name">{{ m.name }}</h3>
                <div class="calories">
                    <i class="fa-solid fa-fire"></i> {{ m.calories }} ุณุนุฑุฉ
                </div>
                <div class="macros-grid" aria-label="ููููุงุช ุบุฐุงุฆูุฉ">
                    <div class="macro-card" aria-label="ุจุฑูุชูู">
                        <div class="macro-icon"><i class="fa-solid fa-drumstick-bite" aria-hidden="true"></i></div>
                        <div class="macro-info">
                            <div class="macro-label">ุจุฑูุชูู</div>
                            <div class="macro-value">{{ m.protein }}g</div>
                        </div>
                    </div>

                    <div class="macro-card" aria-label="ูุฑุจูููุฏุฑุงุช">
                        <div class="macro-icon"><i class="fa-solid fa-bread-slice" aria-hidden="true"></i></div>
                        <div class="macro-info">
                            <div class="macro-label">ูุฑุจูููุฏุฑุงุช</div>
                            <div class="macro-value">{{ m.carbs }}g</div>
                        </div>
                    </div>

                    <div class="macro-card" aria-label="ุฏููู">
                        <div class="macro-icon"><i class="fa-solid fa-bacon" aria-hidden="true"></i></div>
                        <div class="macro-info">
                            <div class="macro-label">ุฏููู</div>
                            <div class="macro-value">{{ m.fat }}g</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ุบุฏุงุก -->
    <h3 class="meal-header">๐ฝ๏ธ ุบุฏุงุก</h3>
    <div class="meal-row">
        <div class="meal-item" *ngFor="let m of day.lunch; let i = index"
            [class.active]="isSelected(day.dayNumber,'lunch', m)" (click)="selectMeal(day.dayNumber,'lunch', m)">
            <div class="image-wrapper">
                <img [src]="m.image" alt="{{ m.name }}" />
                <span class="meal-type">{{ m.mealType }}</span>
            </div>
            <div class="meal-body">
                <h3 class="meal-name">{{ m.name }}</h3>
                <div class="calories">
                    <i class="fa-solid fa-fire"></i> {{ m.calories }} ุณุนุฑุฉ
                </div>
                <div class="macros-grid" aria-label="ููููุงุช ุบุฐุงุฆูุฉ">
                    <div class="macro-card" aria-label="ุจุฑูุชูู">
                        <div class="macro-icon"><i class="fa-solid fa-drumstick-bite" aria-hidden="true"></i></div>
                        <div class="macro-info">
                            <div class="macro-label">ุจุฑูุชูู</div>
                            <div class="macro-value">{{ m.protein }}g</div>
                        </div>
                    </div>

                    <div class="macro-card" aria-label="ูุฑุจูููุฏุฑุงุช">
                        <div class="macro-icon"><i class="fa-solid fa-bread-slice" aria-hidden="true"></i></div>
                        <div class="macro-info">
                            <div class="macro-label">ูุฑุจูููุฏุฑุงุช</div>
                            <div class="macro-value">{{ m.carbs }}g</div>
                        </div>
                    </div>

                    <div class="macro-card" aria-label="ุฏููู">
                        <div class="macro-icon"><i class="fa-solid fa-bacon" aria-hidden="true"></i></div>
                        <div class="macro-info">
                            <div class="macro-label">ุฏููู</div>
                            <div class="macro-value">{{ m.fat }}g</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ูุฌุจุฉ ุฎูููุฉ -->
    <div *ngIf="day.snack?.length">
        <h3 class="meal-header">๐ฟ ูุฌุจุฉ ุฎูููุฉ</h3>
        <div class="meal-row">
            <div class="meal-item" *ngFor="let m of day.snack; let i = index"
                [class.active]="isSelected(day.dayNumber,'snack', m)" (click)="selectMeal(day.dayNumber,'snack', m)">
                <div class="image-wrapper">
                    <img [src]="m.image" alt="{{ m.name }}" />
                    <span class="meal-type">{{ m.mealType }}</span>
                </div>
                <div class="meal-body">
                    <h3 class="meal-name">{{ m.name }}</h3>
                    <div class="calories">
                        <i class="fa-solid fa-fire"></i> {{ m.calories }} ุณุนุฑุฉ
                    </div>
                    <div class="macros-grid" aria-label="ููููุงุช ุบุฐุงุฆูุฉ">
                        <div class="macro-card" aria-label="ุจุฑูุชูู">
                            <div class="macro-icon"><i class="fa-solid fa-drumstick-bite" aria-hidden="true"></i></div>
                            <div class="macro-info">
                                <div class="macro-label">ุจุฑูุชูู</div>
                                <div class="macro-value">{{ m.protein }}g</div>
                            </div>
                        </div>

                        <div class="macro-card" aria-label="ูุฑุจูููุฏุฑุงุช">
                            <div class="macro-icon"><i class="fa-solid fa-bread-slice" aria-hidden="true"></i></div>
                            <div class="macro-info">
                                <div class="macro-label">ูุฑุจูููุฏุฑุงุช</div>
                                <div class="macro-value">{{ m.carbs }}g</div>
                            </div>
                        </div>

                        <div class="macro-card" aria-label="ุฏููู">
                            <div class="macro-icon"><i class="fa-solid fa-bacon" aria-hidden="true"></i></div>
                            <div class="macro-info">
                                <div class="macro-label">ุฏููู</div>
                                <div class="macro-value">{{ m.fat }}g</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ุนุดุงุก -->
    <div *ngIf="day.dinner.length">
        <h3 class="meal-header">๐ ุนุดุงุก</h3>
        <div class="meal-row">
            <div class="meal-item" *ngFor="let m of day.dinner; let i = index"
                [class.active]="isSelected(day.dayNumber,'dinner', m)" (click)="selectMeal(day.dayNumber,'dinner', m )">
                <div class="image-wrapper">
                    <img [src]="m.image" alt="{{ m.name }}" />
                    <span class="meal-type">{{ m.mealType }}</span>
                </div>
                <div class="meal-body">
                    <h3 class="meal-name">{{ m.name }}</h3>
                    <div class="calories">
                        <i class="fa-solid fa-fire"></i> {{ m.calories }} ุณุนุฑุฉ
                    </div>
                    <div class="macros-grid" aria-label="ููููุงุช ุบุฐุงุฆูุฉ">
                        <div class="macro-card" aria-label="ุจุฑูุชูู">
                            <div class="macro-icon"><i class="fa-solid fa-drumstick-bite" aria-hidden="true"></i></div>
                            <div class="macro-info">
                                <div class="macro-label">ุจุฑูุชูู</div>
                                <div class="macro-value">{{ m.protein }}g</div>
                            </div>
                        </div>

                        <div class="macro-card" aria-label="ูุฑุจูููุฏุฑุงุช">
                            <div class="macro-icon"><i class="fa-solid fa-bread-slice" aria-hidden="true"></i></div>
                            <div class="macro-info">
                                <div class="macro-label">ูุฑุจูููุฏุฑุงุช</div>
                                <div class="macro-value">{{ m.carbs }}g</div>
                            </div>
                        </div>

                        <div class="macro-card" aria-label="ุฏููู">
                            <div class="macro-icon"><i class="fa-solid fa-bacon" aria-hidden="true"></i></div>
                            <div class="macro-info">
                                <div class="macro-label">ุฏููู</div>
                                <div class="macro-value">{{ m.fat }}g</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr>

</div>

<button *ngIf="mealDaysView.length" class="save-btn" [disabled]="isSaving || isSaved" (click)="savePlan()">
    <span *ngIf="isSaving">ุฌุงุฑู ุงูุญูุธ...</span>

    <span *ngIf="!isSaving && !isSaved && !saveError">ุญูุธ ุงูุฎุทุฉ</span>

    <span *ngIf="!isSaving && isSaved">ุชู ุงูุญูุธ </span>
</button>
<p *ngIf="saveError" class="text-red-600 mt-2">{{ saveError }}</p>