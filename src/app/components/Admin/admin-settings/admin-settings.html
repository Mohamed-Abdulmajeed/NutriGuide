<div class="admin-settings-wrapper">
    <!-- Header -->
    <header class="settings-header">
        <div class="header-content">
            <button class="back-btn" (click)="goBack()" aria-label="العودة">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7" />
                </svg>
                <span>عودة</span>
            </button>
            <div class="header-title">
                <h1>إعدادات النظام</h1>
                <p>إدارة الأهداف وأنواع الأنظمة</p>
            </div>
        </div>
    </header>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>جارٍ التحميل...</p>
    </div>

    <!-- Toast Container -->
    <div class="toasts-container" role="region" aria-live="polite">
        <div *ngFor="let t of toasts" class="toast" [class.toast-success]="t.type === 'success'"
            [class.toast-error]="t.type === 'error'" [@toastAnimation]>
            <div class="toast-icon">
                <svg *ngIf="t.type === 'success'" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20.285 2l-11.285 11.567-5.556-5.558L0 9.99l8.722 8.728L24 4.728z" />
                </svg>
                <svg *ngIf="t.type === 'error'" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z" />
                </svg>
            </div>
            <span class="toast-message">{{ t.text }}</span>
            <button class="toast-close" (click)="removeToast(t.id)" aria-label="إغلاق الإخطار">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div *ngIf="showConfirmModal" class="modal-overlay" (click)="cancelConfirm()" [@fadeAnimation]>
        <div class="modal-content" (click)="$event.stopPropagation()" [@slideAnimation]>
            <div class="modal-header">
                <h2>تأكيد الحذف</h2>
            </div>
            <div class="modal-body">
                <p>{{ confirmMessage }}</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" (click)="cancelConfirm()">إلغاء</button>
                <button class="btn btn-danger" (click)="confirmDelete()">حذف</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="settings-container" [class.loading]="loading">
        <!-- Tabs -->
        <div class="tabs-wrapper">
            <div class="tabs">
                <button class="tab-btn" [class.active]="tab === 'goals'" (click)="setTab('goals')"
                    [attr.aria-selected]="tab === 'goals'">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="1" />
                        <circle cx="19" cy="12" r="1" />
                        <circle cx="5" cy="12" r="1" />
                    </svg>
                    <span>الأهداف</span>
                </button>
                <button class="tab-btn" [class.active]="tab === 'systems'" (click)="setTab('systems')"
                    [attr.aria-selected]="tab === 'systems'">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                    </svg>
                    <span>أنواع الأنظمة</span>
                </button>
            </div>
        </div>

        <!-- Goals Tab -->
        <section *ngIf="tab === 'goals'" class="tab-content" [@fadeAnimation]>
            <div class="content-card">
                <div class="card-header">
                    <div class="header-info">
                        <h2>الأهداف المتاحة</h2>
                        <p class="subtitle">{{ goals.length }} هدف</p>
                    </div>
                </div>

                <!-- Goals List -->
                <div class="items-list" *ngIf="goals.length > 0; else emptyGoalsState">
                    <div class="item-card" *ngFor="let g of goals" [@itemAnimation]>
                        <div class="item-content">
                            <span class="item-name">{{ g.name }}</span>
                        </div>
                        <button class="btn btn-danger btn-sm" (click)="deleteGoal(g.name)" title="حذف الهدف">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-9l-1 1H5v2h14V4z" />
                            </svg>
                            <span>حذف</span>
                        </button>
                    </div>
                </div>
                <ng-template #emptyGoalsState>
                    <div class="empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5">
                            <circle cx="12" cy="12" r="1" />
                            <circle cx="19" cy="12" r="1" />
                            <circle cx="5" cy="12" r="1" />
                        </svg>
                        <p>لا توجد أهداف في الوقت الحالي</p>
                    </div>
                </ng-template>

                <!-- Add Goal Form -->
                <div class="form-section">
                    <h3 class="form-title">إضافة هدف جديد</h3>
                    <div class="form-group">
                        <input type="text" class="form-input" placeholder="أدخل اسم الهدف" [(ngModel)]="newGoalName"
                            (keyup.enter)="addGoal()">
                        <button class="btn btn-primary" (click)="addGoal()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                            <span>إضافة</span>
                        </button>
                    </div>
                </div>

                <!-- Edit Goal Form -->
                <div class="form-section">
                    <h3 class="form-title">تعديل هدف موجود</h3>
                    <div class="form-group">
                        <select class="form-input" [(ngModel)]="editOldGoal" aria-label="اختر هدفاً لتعديله">
                            <option value="">-- اختر هدفاً لتعديله --</option>
                            <option *ngFor="let g of goals" [value]="g.name">{{ g.name }}</option>
                        </select>
                        <input type="text" class="form-input" placeholder="الاسم الجديد" [(ngModel)]="editNewGoal"
                            (keyup.enter)="updateGoal()">
                        <button class="btn btn-primary" (click)="updateGoal()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z" />
                            </svg>
                            <span>تعديل</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <div *ngIf="tab === 'systems'" class="content-card">
            <div class="card-header">
                <div class="header-info">
                    <h2>أنواع الأنظمة</h2>
                    <p class="subtitle">{{ systems.length }} نظام</p>
                </div>
            </div>

            <!-- Systems List -->
            <div class="items-list" *ngIf="systems.length > 0; else emptySystemsState">
                <div class="item-card" *ngFor="let s of systems" [@itemAnimation]>
                    <div class="item-content">
                        <span class="item-name">{{ s.name }}</span>
                    </div>
                    <button class="btn btn-danger btn-sm" (click)="deleteSystem(s.name)" title="حذف النظام">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-9l-1 1H5v2h14V4z" />
                        </svg>
                        <span>حذف</span>
                    </button>
                </div>
            </div>
            <ng-template #emptySystemsState>
                <div class="empty-state">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                    </svg>
                    <p>لا توجد أنظمة في الوقت الحالي</p>
                </div>
            </ng-template>

            <!-- Add System Form -->
            <div class="form-section">
                <h3 class="form-title">إضافة نظام جديد</h3>
                <div class="form-group">
                    <input type="text" class="form-input" placeholder="أدخل اسم النظام" [(ngModel)]="newSystemName"
                        (keyup.enter)="addSystem()">
                    <button class="btn btn-primary" (click)="addSystem()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        <span>إضافة</span>
                    </button>
                </div>
            </div>

            <!-- Edit System Form -->
            <div class="form-section">
                <h3 class="form-title">تعديل نظام موجود</h3>
                <div class="form-group">
                    <select class="form-input" [(ngModel)]="editOldSystem" aria-label="اختر نظاماً لتعديله">
                        <option value="">-- اختر نظاماً لتعديله --</option>
                        <option *ngFor="let s of systems" [value]="s.name">{{ s.name }}</option>
                    </select>
                    <input type="text" class="form-input" placeholder="الاسم الجديد" [(ngModel)]="editNewSystem"
                        (keyup.enter)="updateSystem()">
                    <button class="btn btn-primary" (click)="updateSystem()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z" />
                        </svg>
                        <span>تعديل</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>