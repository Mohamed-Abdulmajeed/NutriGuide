<div class="admin-settings-wrapper">

    <!-- Header -->
    <header class="settings-header">
        <div class="header-content">
            <button class="back-btn" (click)="goBack()">
                ← عودة
            </button>

            <div class="header-title">
                <h1>إعدادات النظام</h1>
                <p>إدارة الأهداف وأنواع الأنظمة</p>
            </div>
        </div>
    </header>

    <!-- Loading -->
    <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <span>جارٍ التحميل...</span>
    </div>

    <!-- Toasts -->
    <div class="toasts-container">
        <div *ngFor="let t of toasts" class="toast" [class.toast-success]="t.type === 'success'"
            [class.toast-error]="t.type === 'error'">

            <span>{{ t.text }}</span>
            <button (click)="removeToast(t.id)">✕</button>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div *ngIf="showConfirmModal" class="modal-overlay">
        <div class="modal-content">
            <h3>تأكيد الحذف</h3>
            <p>{{ confirmMessage }}</p>
            <div class="modal-actions">
                <button class="btn-secondary" (click)="cancelConfirm()">إلغاء</button>
                <button class="btn-danger" (click)="confirmDelete()">حذف</button>
            </div>
        </div>
    </div>

    <!-- Main -->
    <div class="settings-container" [class.disabled]="loading">

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn" [class.active]="tab === 'goals'" (click)="setTab('goals')">
                الأهداف
            </button>

            <button class="tab-btn" [class.active]="tab === 'systems'" (click)="setTab('systems')">
                أنواع الأنظمة
            </button>
        </div>

        <!-- GOALS -->
        <section *ngIf="tab === 'goals'" class="content-card">

            <div class="card-header">
                <h2>الأهداف</h2>
                <span>{{ goals.length }} هدف</span>
            </div>

            <div *ngIf="goals.length; else emptyGoals" class="items-list">
                <div class="item-card" *ngFor="let g of goals">
                    <span>{{ g.name }}</span>
                    <button class="btn-danger btn-sm" (click)="deleteGoal(g.name)">
                        حذف
                    </button>
                </div>
            </div>

            <ng-template #emptyGoals>
                <p class="empty">لا توجد أهداف</p>
            </ng-template>

            <!-- Add -->
            <div class="form-section">
                <h4>إضافة هدف</h4>
                <div class="form-group">
                    <input style="color: aliceblue;" type="text" [(ngModel)]="newGoalName" placeholder="اسم الهدف">
                    <button class="btn-primary" (click)="addGoal()">إضافة</button>
                </div>
            </div>

            <!-- Edit -->
            <div class="form-section">
                <h4>تعديل هدف</h4>
                <div class="form-group">
                    <select style="color: aliceblue;" [(ngModel)]="editOldGoal">
                        <option value="">اختر هدف</option>
                        <option style="color: aliceblue;" *ngFor="let g of goals" [value]="g.name">{{ g.name }}</option>
                    </select>

                    <input style="color: aliceblue;" type="text" [(ngModel)]="editNewGoal" placeholder="الاسم الجديد">

                    <button class="btn-primary" (click)="updateGoal()">تعديل</button>
                </div>
            </div>

        </section>

        <!-- SYSTEMS -->
        <section *ngIf="tab === 'systems'" class="content-card">

            <div class="card-header">
                <h2>أنواع الأنظمة</h2>
                <span>{{ systems.length }} نظام</span>
            </div>

            <div *ngIf="systems.length; else emptySystems" class="items-list">
                <div class="item-card" *ngFor="let s of systems">
                    <span>{{ s.name }}</span>
                    <button class="btn-danger btn-sm" (click)="deleteSystem(s.name)">
                        حذف
                    </button>
                </div>
            </div>

            <ng-template #emptySystems>
                <p class="empty">لا توجد أنظمة</p>
            </ng-template>

            <!-- Add -->
            <div class="form-section">
                <h4>إضافة نظام</h4>
                <div class="form-group">
                    <input style="color: aliceblue;" type="text" [(ngModel)]="newSystemName" placeholder="اسم النظام">
                    <button class="btn-primary" (click)="addSystem()">إضافة</button>
                </div>
            </div>

            <!-- Edit -->
            <div class="form-section">
                <h4>تعديل نظام</h4>
                <div class="form-group">
                    <select style="color: aliceblue;" [(ngModel)]="editOldSystem">
                        <option value="">اختر نظام</option>
                        <option style="color: aliceblue;" *ngFor="let s of systems" [value]="s.name">{{ s.name }}
                        </option>
                    </select>

                    <input style="color: aliceblue;" type="text" [(ngModel)]="editNewSystem" placeholder="الاسم الجديد">

                    <button class="btn-primary" (click)="updateSystem()">تعديل</button>
                </div>
            </div>

        </section>

    </div>
</div>